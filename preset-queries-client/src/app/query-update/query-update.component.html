<form #queryForm="ngForm">

  <div class="form-group">
    <label >Query name</label>
    <input [(ngModel)]="query.name" class="form-control form-control-sm" placeholder="name (must be unique)" name="name">
  </div>

  <div class="form-group">
    <label>Business description</label>
    <input [(ngModel)]="query.description" class="form-control form-control-sm" placeholder="A business description" name="description">
  </div>

  <div *ngIf="configurations" class="form-group">
    <label>Source configuration</label>
    <select class="form-control" required [(ngModel)]="query.configurationId" name="configuration">
      <option *ngFor="let conf of configurations" [value]="conf.id">{{conf.name}}</option>
    </select>
  </div>

  <div class="form-group">
    <label >Template</label>
    <textarea [(ngModel)]="query.template" class="form-control form-control-sm" placeholder="jdbc template" name="template"></textarea>
  </div>

  <hr>
  <div>Parameters <button href="#" (click)="addParameter()" class="badge badge-info">add</button></div>

  <ol *ngIf="parameterTypes">
    <li *ngFor="let parameter of query.parameters; let paramNum = index;"><strong>{{parameter.name}}</strong>
      <button href="#" (click)="query.parameters.splice(paramNum,1)" class="badge badge-danger">delete</button>
      <div class="form-group">
        <label>Parameter name</label>
        <input [(ngModel)]="parameter.name" class="form-control form-control-sm" placeholder="parameter name" name="parameter-name-{{paramNum}}" />
      </div>
      <div class="form-group">
        <label>Parameter type</label>
        <select [(ngModel)]="parameter.type" class="form-control form-control-sm" name="parameter-type-{{paramNum}}">
          <option *ngFor="let paramType of parameterTypes" [ngValue]="paramType.name">{{paramType.label}}</option>
        </select>
      </div>
      <div *ngIf="getParameterTypeFromParameterTypeName(parameter.type).isParameterized" class="form-group">
        <label>{{getParameterTypeFromParameterTypeName(parameter.type).parametersLabel}} ({{getParameterTypeFromParameterTypeName(parameter.type).hint}})</label>
        <textarea [(ngModel)]="parameter.optionalFragment" class="form-control form-control-sm" placeholder="{{getParameterTypeFromParameterTypeName(parameter.type).parametersLabel}}" name="optional-fragment-{{paramNum}}"></textarea>
      </div>
    </li>
  </ol>

</form>

<button (click)="update()" class="btn btn-success btn-sm">update</button>
<button (click)="reload()" class="btn btn-light btn-sm float-right">cancel</button>

